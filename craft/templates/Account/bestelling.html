{% extends '_layouts/site' %}

{% set number = craft.request.param('id') %}

{% if number %}
    {% set order = craft.commerce.orders.number(number).first() %}
{% endif %}

{% if order is not defined or not order %}
    {% redirect 'shop/customer' %}
{% endif %}

{% requireLogin %}

{% block main %}

    <div class="container py-3 account">
        <div class="row py-2 card my-5">
            <div class="col-md-10 ml-3">
                <div class="p-5">
                    <h1 class="mb-5">Bestelling #{{ order.id }}</h1>

                    <div class="row mb-5">
                        <div class="col-md-4">
                            <h4><strong>Details</strong></h4>

                            <ul class="list-group">
                                <li class="m-0 p-0"><strong>Klant:</strong> {{ order.email }}</li>
                                <li class="m-0 p-0"><strong>Totaal betaald:</strong> {{ order.totalPaid|commerceCurrency('EUR') }}</li>
                                <li class="m-0 p-0"><strong>Datum:</strong> {{ order.dateOrdered }}</li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h4><strong>Factuur adres</strong></h4>

                            {% set address = order.billingAddress %}

                            <ul class="list-group">
                                {% if address.firstName is not empty or address.lastName is not empty %}
                                    <li class="p-0 m-0">
                                        <strong>
                                            {% if address.attention is not empty %}
                                                Att: {{ address.attention }}
                                            {% endif %}
                                            <br>
                                            {% if address.title is not empty %}
                                                {{ address.title }}
                                            {% endif %}

                                            {% if address.firstName is not empty %}
                                                {{ address.firstName }}
                                            {% endif %}

                                            {% if address.lastName is not empty %}
                                                {{ address.lastName }}
                                            {% endif %}

                                            {% if address.businessName is not empty %}
                                                {{ address.businessName }}
                                            {% endif %}

                                            {% if address.businessTaxId is not empty %}
                                                - {{ address.businessTaxId }}
                                            {% endif %}
                                        </strong>
                                    </li>
                                {% endif %}

                                {% if address.address1 is not empty %}
                                    <li class="p-0 m-0">{{ address.address1 }}</li>
                                {% endif %}

                                {% if address.address2 is not empty %}
                                    <li class="p-0 m-0">{{ address.address2 }}</li>
                                {% endif %}


                                {% if address.zipCode is not empty or address.city is not empty %}
                                    <li class="p-0 m-0">
                                        {% if address.zipCode is not empty %}
                                            {{ address.zipCode }}
                                        {% endif %}

                                        {% if address.city is not empty %}
                                            {{ address.city }}
                                        {% endif %}
                                    </li>
                                {% endif %}


                                {% if address.countryText is defined %}
                                    <li class="p-0 m-0">{{ address.countryText }}</li>
                                {% endif %}

                                {% if address.stateText is defined %}
                                    <li class="p-0 m-0">{{ address.stateText }}</li>
                                {% endif %}

                                {% if address.phone is not empty %}
                                    <li class="p-0 m-0">{{ address.phone }}</li>
                                {% endif %}

                                {% if address.alternativePhone is not empty %}
                                    <li class="p-0 m-0">{{ address.alternativePhone }}</li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>


                    {% if order.pdfUrl %}
                        <h4><strong>Bestelbon</strong> <small>(<a href="{{ order.getPdfUrl('receipt') }}">Download</a>)</small></h4>
                    {% endif %}

                    <table class="table">
                        <thead>
                            <tr>
                                <th class="pl-0">Item</th>
                                <th class="pl-0">Unit Price</th>
                                <th></th>
                                <th class="text-right pl-0">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in order.lineItems %}
                                <tr>
                                    <td>
                                        <strong>{{ item.description }}</strong><br>
                                    </td>
                                    <td>
                                        {% if item.onSale %}
                                            <strike>{{ item.price|commerceCurrency('EUR') }}</strike>   {{ item.salePrice|commerceCurrency('EUR') }}
                                        {% else %}
                                            {{ item.price|commerceCurrency('EUR') }}
                                        {% endif %}
                                    </td>
                                    <td></td>
                                    <td class="text-right">{{ item.subtotal|commerceCurrency('EUR') }}</td>
                                </tr>
                            {% endfor %}

                            {% for adjustment in order.adjustments %}
                                <tr>
                                    <td>{{ adjustment.type }}</td>
                                    <td colspan="2"><strong>{{ adjustment.name }}</strong><br>({{ adjustment.description }})</td>
                                    <td class="text-right">{{ adjustment.amount|commerceCurrency('EUR') }}</td>
                                </tr>
                            {% endfor %}

                            <tr>
                                <td colspan="4" class="text-right">
                                    <h4>Totaal: {{ order.totalPrice|commerceCurrency('EUR') }}</h4>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

{% endblock %}