{% extends '_layouts/site' %}

{% block main %}

    {% set addresses = craft.commerce.customer.addresses %}

    <div class="container pt-5 pb-5">
        <div class="row">
            <div class="col-md-12">
                <div class="page-header">
                    <h1>Gegevens</h1>
                </div>
            </div>
            <div class="col-md-8">
                <form method="post">
                    <input type="hidden" name="action" value="commerce/cart/updateCart" />
                    <input type="hidden" name="redirect" value="/afrekenen" />
                    <input type="hidden" name="address[countryId]" value="166" />
                    <input type="hidden" name="sameAddress" value="0" />

                    {{ getCsrfInput() }}

                    {% if not cart.email %}
                        <div class="form-group">
                            <label for="">Email</label>
                            <input class="form-control" type="text" value="{{ cart.email }}" name="email" />
                            <span class="flash">{{ cart.getErrors('email')|join }}</span><br>
                        </div>
                    {% endif %}

                    <div class="form-group">
                        <label for="">Voornaam *</label>
                        <input type="text" class="form-control" name="address[firstName]" {% if currentUser %}value="{{ currentUser.firstName }}"{% endif %} required />
                    </div>

                    <div class="form-group">
                        <label for="">Achternaam *</label>
                        <input type="text" class="form-control" name="address[lastName]" {% if currentUser %}value="{{ currentUser.lastName }}"{% endif %} required />
                    </div>

                    <div class="form-group">
                        <label for="">Telefoonnummer *</label>
                        <input type="text" class="form-control" name="address[phone]" required />
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Door naar afrekenen</button>
                    </div>
                </form>
            </div>
            <div class="col-md-4">
                {% set totalPrice = 0 %}

                <table class="table">
                    <tbody>
                        {% for item in cart.lineItems %}
                            {% set product = craft.commerce.products.id(item.purchasable.productId).first %}
                            {% set totalPrice = totalPrice + item.price %}

                            <tr>
                                <td>{{ product.title }}</td>
                                <td>{{ item.price|currency('EUR') }}</td>
                            </tr>
                        {% endfor %}
                        <tr>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><strong>Totaal</strong></td>
                            <td><strong>{{ totalPrice|currency('EUR') }}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

{% endblock %}